<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>PDF Reader - Dev Software</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { font-family: Arial; background:#fafafa; padding:20px; }
    h2 { margin-bottom:10px; }
    button {
        padding:12px 18px;
        background:#007bff;
        border:none;
        color:white;
        border-radius:6px;
        font-size:16px;
        margin-bottom:20px;
    }
    #list { padding-top:15px; }
    .pdf-item {
        padding:10px;
        background:white;
        border-radius:6px;
        margin-bottom:8px;
        border:1px solid #ddd;
    }
</style>

<script type="module">
    import { Capacitor } from "https://cdn.jsdelivr.net/npm/@capacitor/core@latest/dist/capacitor.js";

    const Permissions = {
        async check() {
            return await Capacitor.Plugins.Permissions.query({ name: "android.permission.READ_MEDIA_DOCUMENTS" });
        },

        async request() {
            return await Capacitor.Plugins.Permissions.request({
                permissions: [
                    "android.permission.READ_MEDIA_DOCUMENTS",
                    "android.permission.READ_MEDIA_IMAGES",
                    "android.permission.READ_MEDIA_VIDEO"
                ]
            });
        },

        async openSettings() {
            await Capacitor.Plugins.App.openSettings();
        }
    };

    async function listPDF() {
        const resultBox = document.getElementById("list");
        resultBox.innerHTML = "<b>PDF aranÄ±yor...</b>";

        const perm = await Permissions.check();

        if (!perm.granted) {
            resultBox.innerHTML = `
                <div style='color:#b00'>Ä°zin verilmedi!</div><br>
                <button onclick="openSettings()">Ayarlara Git</button>
            `;
            return;
        }

        // Capacitor Filesystem Ã§aÄŸrÄ±sÄ±
        const files = await Capacitor.Plugins.Filesystem.readdir({
            path: "",
            directory: "DOCUMENTS"
        });

        const pdfs = files.files.filter(f => f.toLowerCase().endsWith(".pdf"));

        if (pdfs.length === 0) {
            resultBox.innerHTML = "<i>PDF bulunamadÄ±.</i>";
            return;
        }

        resultBox.innerHTML = "";
        pdfs.forEach(f => {
            resultBox.innerHTML += `<div class='pdf-item'>ðŸ“„ ${f}</div>`;
        });
    }

    window.askPermission = async () => {
        const res = await Permissions.request();
        if (res.granted) listPDF();
        else openSettings();
    };

    window.openSettings = () => Permissions.openSettings();
    window.listPDF = () => listPDF();
</script>

</head>
<body>

<h2>PDF Reader</h2>

<button onclick="askPermission()">ðŸ“‚ PDF Ä°zni Ver & Listele</button>

<div id="list"></div>

</body>
</html>
